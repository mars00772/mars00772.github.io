<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Apache Pig in Practice 1 | KOO&#39;s Playground</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I write many pig script in the past few months and have explored some tricks with my buddies. hopes it could help someone.
Let’s focus on some interesting topics in this first article and get prepared">
<meta property="og:type" content="article">
<meta property="og:title" content="Apache Pig in Practice 1">
<meta property="og:url" content="/2015/03/04/Apache Pig in Practice 1/index.html">
<meta property="og:site_name" content="KOO's Playground">
<meta property="og:description" content="I write many pig script in the past few months and have explored some tricks with my buddies. hopes it could help someone.
Let’s focus on some interesting topics in this first article and get prepared">
<meta property="og:image" content="http://wenzhong.qiniudn.com/pig1.png">
<meta property="og:updated_time" content="2015-06-07T11:00:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Apache Pig in Practice 1">
<meta name="twitter:description" content="I write many pig script in the past few months and have explored some tricks with my buddies. hopes it could help someone.
Let’s focus on some interesting topics in this first article and get prepared">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href='//fonts.useso.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
  <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" type="text/css">
  

  
</head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo"><i class="logo"></i><span class="site-title">KOO&#39;s Playground</span></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div class="profile" id="profile-nav">
          <a id="profile-anchor" href="javascript:;"><img class="avatar" src="/css/images/avatar.png"><i class="fa fa-caret-down"></i></a>
        </div>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value=""></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
      
        <td><a class="main-nav-link" href="/">Home</a></td>
      
        <td><a class="main-nav-link" href="/archives">Archives</a></td>
      
        <td><a class="main-nav-link" href="/about">About</a></td>
      
      <td>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value=""></form>
      </td>
      </tr>
    </table>
  </div>
</header>
    <div class="outer">
      <aside id="profile">
  <div class="inner profile-inner">
  	<div class="base-info profile-block">
		  <img id="avatar" src="/css/images/avatar.png">
      <h2 id="name">KOO</h2>
      <h3 id="title">C++ BackEnd Developer</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Guangzhou, China</span>
      <a id="follow" href="https://github.com/mars00772">关注我</a>
  	</div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        4
        <span>文章</span>
      </div>
      <div class="article-info-block">
        4
        <span>标签</span>
      </div>
    </div>
    
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
        
          <td><a href="https://github.com/mars00772" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
        
          <td><a href="/#" target="_blank" title="twitter"><i class="fa fa-twitter"></i></a></td>
        
          <td><a href="/atom.xml" target="_blank" title="rss"><i class="fa fa-rss"></i></a></td>
        
        </tr>
      </table>
    </div>
    
  </div>
</aside>
      <section id="main"><article id="post-Apache Pig in Practice 1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Apache Pig in Practice 1
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/2015/03/04/Apache Pig in Practice 1/">
    <time datetime="2015-03-03T17:27:43.000Z" itemprop="datePublished">2015-03-04</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Engineering/">Engineering</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Engineering/Big-Data/">Big Data</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://wenzhong.qiniudn.com/pig1.png" alt=""><br>I write many pig script in the past few months and have explored some tricks with my buddies. hopes it could help someone.</p>
<p>Let’s focus on some interesting topics in this first article and get prepared for the later Pig rush.</p>
<a id="more"></a>
<h2 id="IDE_&amp;_Environment">IDE &amp; Environment</h2><h3 id="Vim">Vim</h3><p>I use Vim to write most script language and those are my favourite plugins to write Pig:</p>
<ul>
<li><a href="http://www.vim.org/scripts/script.php?script_id=2186" target="_blank" rel="external">Pig Syntax Highlight</a>. Latest update on Jun 2014, Pig 0.12 supported.</li>
<li><a href="https://github.com/Valloric/YouCompleteMe" target="_blank" rel="external">You complete me</a>. Best auto-complete plugins ever. If you don’t use a MAC, <a href="https://github.com/ervandew/supertab" target="_blank" rel="external">Supertab</a> is also a reasonable choice.</li>
<li><a href="https://github.com/godlygeek/tabular" target="_blank" rel="external">Tabularize</a> Align and keep cleaness of the Pig codelet. Most common usage is <code>:Tab/AS</code> to align <code>FOREACH ... GENERATE</code> clause.</li>
</ul>
<p>To improve debug efficiency, I like to run pig with short cut. Here are my simple approach: add the following in <code>.vimrc</code> for quick run with <code>F5</code><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">map &#60;F5&#62; :call Compile_Run()&#60;CR&#62;&#10;function Compile_Run()&#10;    if &#38;filetype==&#34;coffee&#34;&#10;        :w&#10;        !coffee % 2&#62;&#38;1&#10;    elseif &#38;filetype==&#34;cpp&#34;&#10;        :w&#10;        !g++ -g -o %&#60; %; ./%&#60;&#10;    elseif &#38;filetype==&#34;python&#34;&#10;        :w&#10;        !python %&#10;    elseif &#38;filetype==&#34;pig&#34;&#10;        :w&#10;        !./run_pig.sh %</span><br></pre></td></tr></table></figure></p>
<p>revise <code>run_pig.sh</code> as you like. General idea is reduce redundant work and typo.</p>
<!-- more -->
<p>Basic form would be:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pig -x local $1</span><br></pre></td></tr></table></figure></p>
<p>or with default local debug settings<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">intput=./input.txt&#10;output=./output&#10;rm -rf $&#123;output?&#125;&#10;pig -x local -Dinput=$&#123;input&#125; -Doutput=$&#123;output&#125; $1</span><br></pre></td></tr></table></figure></p>
<h2 id="Modulize_your_Pig_code_using_Marco">Modulize your Pig code using Marco</h2><h3 id="Under_standing_Marco">Under standing Marco</h3><p>We have mix feelings with Marco, still I love it better.</p>
<p>Marco could help organize and reuse your code. Marco in Pig is quite like Marco in C — they do substitution. Think about you want to do the same series of operation with 3 dataset… Try refactor it into a marco, you will absolutely thank your mercy later.</p>
<p>Understanding the <code>$</code> sign is important when using Marco. <code>$</code> decorate those variable to be replaced</p>
<figure class="highlight plain"><figcaption><span>number1.txt</span></figcaption><table><tr><td class="code"><pre><span class="line">1&#10;2&#10;3&#10;4&#10;5</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><figcaption><span>filter.marco</span></figcaption><table><tr><td class="code"><pre><span class="line">DEFINE filter_small_number (events, threshold) RETURNS filtered_events &#123;&#10;    $filtered_events = FILTER $events BY a &#62; $threshold;&#10;&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">IMPORT &#39;filter.marco&#39;;&#10;&#10;events = LOAD &#39;./data/number1.txt&#39; AS (a:int);&#10;&#10;big_number = filter_small_number(events, 2);&#10;&#10;DUMP big_number;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(3)&#10;(4)&#10;(5)</span><br></pre></td></tr></table></figure>
<p>Easy. </p>
<p>However, you’d better not change input with in a Marco. they are just substitution, every change in input variables are global </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">IMPORT &#39;filter.marco&#39;;&#10;&#10;events = LOAD &#39;./data/number1.txt&#39; AS (a:int);&#10;&#10;big_number = filter_small_number(events, 2);&#10;&#10;DUMP big_number;&#10;DUMP events;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DEFINE filter_small_number (events, threshold) RETURNS filtered_events &#123;&#10;    $filtered_events = FILTER $events BY a &#62; $threshold;&#10;    $events = FILTER $events BY a == 4;&#10;&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">big_number&#10;(3)&#10;(4)&#10;(5)&#10;&#10;events&#10;(4)</span><br></pre></td></tr></table></figure>
<p>You can also return multiple data set in Marco<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DEFINE split_events (events, threshold) RETURNS big, small &#123;&#10;    $big = FILTER $events BY a &#62;= $threshold;&#10;    $small = FILTER $events BY a &#60; $threshold;&#10;&#125;;&#10;&#10;events = LOAD &#39;./data/number1.txt&#39; AS (a:int);&#10;&#10;big_num, small_num = split_events(events, 3);&#10;&#10;DUMP big_num;&#10;DUMP small_num;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">big&#10;(3)&#10;(4)&#10;(5)&#10;small&#10;(1)&#10;(2)</span><br></pre></td></tr></table></figure>
<h3 id="What’s_not_so_cool">What’s not so cool</h3><p>One reason we love Marco less is that after marco is plugined into Pig then error message become a little difficult to read and resolve root cause, because line number would be reflecting the reassembled Pig scripts. However, it’s still a great tool and a must have skill to use Pig.</p>
<h1 id="INPUT_and_OUTPUT">INPUT and OUTPUT</h1><h2 id="INPUT">INPUT</h2><ul>
<li>You can almost load everything, HDFS / Avro / Protobuf / Hive / Elastic Search / MongoDB.</li>
</ul>
<h2 id="OUTPUT">OUTPUT</h2><ul>
<li>Of course, there are Storage Function in Pair for above persistency / serialization tools.</li>
<li>MultiStorage could help you store data hierarchily, which mean you could partition result when storing, absolutly must-know features.</li>
</ul>
<h1 id="Third_party_Pig_library">Third party Pig library</h1><ul>
<li><a href="https://cwiki.apache.org/confluence/display/PIG/PiggyBank" target="_blank" rel="external">piggybank</a></li>
<li><a href="http://data.linkedin.com/opensource/datafu" target="_blank" rel="external">DataFu</a> from LinkedIn</li>
<li><a href="https://github.com/twitter/elephant-bird/" target="_blank" rel="external">ElephantBird</a> from twitter</li>
<li><a href="http://hortonworks.com/hadoop/hcatalog/" target="_blank" rel="external">Hcatalog</a></li>
</ul>
<h1 id="UDF">UDF</h1><p>Once you know you could use Python/Ruby/JS to write UDF, I suppose nobody will try to use JAVA for common cases.<br><a href="http://pig.apache.org/docs/r0.9.1/udf.html#python-udfs" target="_blank" rel="external">Python UDF</a></p>
<h1 id="Unit_test">Unit test</h1><h2 id="PigUnit">PigUnit</h2><p>Write UT to be a good man. Of course, Pig could and should be unit-tested. The <a href="http://pig.apache.org/docs/r0.8.1/pigunit.html" target="_blank" rel="external">PigUnit</a> backbone are supported in Java. However docs are limited and you might run into many troubles.</p>
<h2 id="Unit_test_a_python_UDF">Unit test a python UDF</h2><p>when using native <code>unittest</code> packages to test the python script，<code>outputSchema</code> will complains. One way is to add Pig support in Python script, the other one is to disable the outputSchema notation. Here we should the second tricks, put this codelet at the top of the UDF.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if __name__ != &#39;__lib__&#39;: &#10;    def outputSchema(dont_care): &#10;        def wrapper(func): &#10;            def inner(*args, **kwargs): &#10;                return func(*args, **kwargs) &#10;        return inner &#10;    return wrapper</span><br></pre></td></tr></table></figure>
<p>This block is intended to test the UDF with the outputSchema notation. The <code>__name__</code> will be marked as ‘lib’ when script is call by Pig. So it will not take effect when the script is running as Pig UDF. </p>
<h1 id="References">References</h1><p><a href="https://developer.yahoo.com/blogs/hadoop/comparing-pig-latin-sql-constructing-data-processing-pipelines-444.html" target="_blank" rel="external">Comparing Pig Latin and SQL for Constructing Data Processing Pipelines</a> By Alan Gates, Pig Architect in Yahoo.<br><a href="http://shop.oreilly.com/product/0636920018087.do" target="_blank" rel="external">Programming Pig</a> also by Alan Gates.<br><a href="http://www.packtpub.com/pig-design-patterns/book" target="_blank" rel="external">Pig Design Pattern</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="/2015/03/04/Apache Pig in Practice 1/" data-id="cianvjd940000p4qhy2q8cpl4" class="article-share-link">分享到</a>
      
        <a href="/2015/03/04/Apache Pig in Practice 1/#disqus_thread" class="article-comment-link">评论</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hadoop/">Hadoop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pig/">Pig</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/04/04/UNP1/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          unix network programming笔记
        
      </div>
    </a>
  
  
    <a href="/2014/07/04/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul id="recent-post" class="">
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2015/04/07/effective tcp/" class="thumbnail">
  
    <span style="background-image:url(http://www.cppblog.com/images/cppblog_com/Solstice/Windows-Live-Writer/958c781e7d58_E312/router_3.png
)" alt="Notes On Effective TCP/IP Programming" class="thumbnail-image"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/读书笔记/">读书笔记</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/读书笔记/网络编程/">网络编程</a></p>
              <p class="item-title"><a href="/2015/04/07/effective tcp/" class="title">Notes On Effective TCP/IP Programming</a></p>
              <p class="item-date"><time datetime="2015-04-06T17:27:43.000Z" itemprop="datePublished">2015-04-07</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2015/04/04/UNP1/" class="thumbnail">
  
    <span style="background-image:url(https://raw.githubusercontent.com/mars00772/write/master/unp1/tcp%E5%8D%8F%E8%AE%AE%E6%A6%82%E8%B2%8C.JPG
)" alt="unix network programming笔记" class="thumbnail-image"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/读书笔记/">读书笔记</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/读书笔记/网络编程/">网络编程</a></p>
              <p class="item-title"><a href="/2015/04/04/UNP1/" class="title">unix network programming笔记</a></p>
              <p class="item-date"><time datetime="2015-04-03T17:27:43.000Z" itemprop="datePublished">2015-04-04</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2015/03/04/Apache Pig in Practice 1/" class="thumbnail">
  
    <span style="background-image:url(http://wenzhong.qiniudn.com/pig1.png
)" alt="Apache Pig in Practice 1" class="thumbnail-image"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Engineering/">Engineering</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Engineering/Big-Data/">Big Data</a></p>
              <p class="item-title"><a href="/2015/03/04/Apache Pig in Practice 1/" class="title">Apache Pig in Practice 1</a></p>
              <p class="item-date"><time datetime="2015-03-03T17:27:43.000Z" itemprop="datePublished">2015-03-04</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2014/07/04/hello-world/" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"></p>
              <p class="item-title"><a href="/2014/07/04/hello-world/" class="title">Hello World</a></p>
              <p class="item-date"><time datetime="2014-07-03T17:27:43.000Z" itemprop="datePublished">2014-07-04</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Engineering/">Engineering</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Engineering/Big-Data/">Big Data</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书笔记/">读书笔记</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/读书笔记/网络编程/">网络编程</a><span class="category-list-count">2</span></li></ul></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hadoop/">Hadoop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pig/">Pig</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/笔记/">笔记</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络编程/">网络编程</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Hadoop/" style="font-size: 10px;">Hadoop</a> <a href="/tags/Pig/" style="font-size: 10px;">Pig</a> <a href="/tags/笔记/" style="font-size: 20px;">笔记</a> <a href="/tags/网络编程/" style="font-size: 20px;">网络编程</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">七月 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 KOO<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script>
  var disqus_shortname = 'httpmars00772githubio';
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.useso.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>